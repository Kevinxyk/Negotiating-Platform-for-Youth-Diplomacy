<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>功能测试页面</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body { padding: 20px; }
        .test-section { margin-bottom: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .user-status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 0.5rem;
        }
        .user-status-online { background-color: #28a745; }
        .user-status-speaking { background-color: #007bff; animation: pulse 1.5s infinite; }
        .user-status-raising-hand { background-color: #ffc107; animation: pulse 1s infinite; }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>研讨室功能测试</h1>
        
        <div class="test-section">
            <h3>用户列表功能</h3>
            <button class="btn btn-primary" onclick="testUserList()">测试用户列表更新</button>
            <div id="userListTest" class="mt-3">
                <h5>在线用户 (0人)</h5>
                <ul id="testUserList" class="list-group list-group-horizontal flex-wrap"></ul>
            </div>
        </div>
        
        <div class="test-section">
            <h3>表情包功能</h3>
            <button class="btn btn-success" onclick="toggleEmojiPanel()">显示/隐藏表情包</button>
            <div id="emojiPanelTest" class="mt-3" style="display: none;">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <small class="text-muted">选择表情包</small>
                    <button type="button" class="btn-close btn-close-sm" onclick="toggleEmojiPanel()"></button>
                </div>
                <div id="emojiGridTest" class="d-flex flex-wrap gap-1"></div>
            </div>
            <div class="mt-3">
                <textarea id="testMessageInput" class="form-control" placeholder="测试消息输入..." rows="3"></textarea>
            </div>
        </div>
        
        <div class="test-section">
            <h3>消息显示测试</h3>
            <button class="btn btn-warning" onclick="testMessageDisplay()">测试消息显示</button>
            <div id="messageTest" class="mt-3">
                <div id="testMessages" class="border p-2" style="height: 200px; overflow-y: auto;"></div>
            </div>
        </div>
    </div>

    <script>
        const testUsers = [
            { name: '张三', role: 'delegate', country: '中国', isRaisingHand: true, isSpeaking: false, canSpeak: true, score: 85 },
            { name: '李四', role: 'judge', country: '联合国', isRaisingHand: false, isSpeaking: true, canSpeak: true, score: 92 },
            { name: '王五', role: 'host', country: '联合国', isRaisingHand: false, isSpeaking: false, canSpeak: true, score: 88 }
        ];

        const emojis = ['😀', '😃', '😄', '😁', '😆', '😅', '😂', '🤣', '😊', '😇'];

        function testUserList() {
            const userList = document.getElementById('testUserList');
            const userCountElement = document.querySelector('#userListTest h5');
            
            userList.innerHTML = '';
            
            testUsers.forEach(user => {
                const userItem = document.createElement('li');
                userItem.className = 'list-group-item d-flex align-items-center';
                
                const statusIndicator = document.createElement('span');
                statusIndicator.className = 'user-status-indicator';
                
                if (user.isSpeaking) {
                    statusIndicator.classList.add('user-status-speaking');
                } else if (user.isRaisingHand) {
                    statusIndicator.classList.add('user-status-raising-hand');
                } else {
                    statusIndicator.classList.add('user-status-online');
                }
                
                const userInfo = document.createElement('div');
                userInfo.className = 'flex-grow-1';
                
                const userName = document.createElement('strong');
                userName.textContent = user.name;
                
                const userDetails = document.createElement('small');
                userDetails.className = 'text-muted d-block';
                userDetails.textContent = `${user.role} | ${user.country} | 评分: ${user.score}`;
                
                userInfo.appendChild(userName);
                userInfo.appendChild(userDetails);
                
                const statusIcons = document.createElement('div');
                statusIcons.className = 'ms-2 d-flex gap-1';
                
                if (user.isRaisingHand) {
                    const raiseHandIcon = document.createElement('i');
                    raiseHandIcon.className = 'bi bi-hand-index text-warning';
                    raiseHandIcon.title = '正在举手';
                    statusIcons.appendChild(raiseHandIcon);
                }
                
                if (user.isSpeaking) {
                    const speakingIcon = document.createElement('i');
                    speakingIcon.className = 'bi bi-mic-fill text-primary';
                    speakingIcon.title = '正在发言';
                    statusIcons.appendChild(speakingIcon);
                }
                
                userItem.appendChild(statusIndicator);
                userItem.appendChild(userInfo);
                userItem.appendChild(statusIcons);
                userList.appendChild(userItem);
            });
            
            if (userCountElement) {
                userCountElement.textContent = `在线用户 (${testUsers.length}人)`;
            }
        }

        function toggleEmojiPanel() {
            const panel = document.getElementById('emojiPanelTest');
            if (panel.style.display === 'none') {
                panel.style.display = 'block';
                initEmojiGrid();
            } else {
                panel.style.display = 'none';
            }
        }

        function initEmojiGrid() {
            const grid = document.getElementById('emojiGridTest');
            grid.innerHTML = '';
            
            emojis.forEach(emoji => {
                const emojiBtn = document.createElement('button');
                emojiBtn.className = 'btn btn-outline-secondary btn-sm';
                emojiBtn.style.fontSize = '1.2rem';
                emojiBtn.style.padding = '0.25rem 0.5rem';
                emojiBtn.textContent = emoji;
                emojiBtn.title = emoji;
                
                emojiBtn.addEventListener('click', () => {
                    const messageInput = document.getElementById('testMessageInput');
                    const cursorPos = messageInput.selectionStart;
                    const textBefore = messageInput.value.substring(0, cursorPos);
                    const textAfter = messageInput.value.substring(cursorPos);
                    messageInput.value = textBefore + emoji + textAfter;
                    messageInput.focus();
                    messageInput.setSelectionRange(cursorPos + emoji.length, cursorPos + emoji.length);
                });
                
                grid.appendChild(emojiBtn);
            });
        }

        function testMessageDisplay() {
            const messages = [
                { sender: '张三', content: '大家好！', timestamp: new Date().toISOString() },
                { sender: '李四', content: '😊 很高兴见到大家', timestamp: new Date().toISOString() }
            ];
            
            messages.forEach(msg => {
                addTestMessage(msg.sender, msg.content, msg.timestamp);
            });
        }

        function addTestMessage(sender, content, timestamp) {
            const messagesContainer = document.getElementById('testMessages');
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'mb-2 p-2 border rounded';
            
            const messageContent = document.createElement('div');
            messageContent.textContent = content;
            
            const messageInfo = document.createElement('small');
            messageInfo.className = 'text-muted d-block mt-1';
            messageInfo.textContent = `${sender} - ${new Date(timestamp).toLocaleTimeString()}`;
            
            messageDiv.appendChild(messageContent);
            messageDiv.appendChild(messageInfo);
            messagesContainer.appendChild(messageDiv);
            
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
    </script>
</body>
</html> 